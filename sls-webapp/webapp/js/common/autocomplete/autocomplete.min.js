function autoComplete(inputs,url){var basePath=(function(){var url=window.location+"";var h=url.split("//");var x=h[1].split("/");return h[0]+"//"+window.location.host+"/"+x[1]+"/";})();var index=0;var maxId=0;var $this;var $showTextId;var $showTipOri;var closeFlag=true;var $oriObj;var $desObj;var setTimeOutEvent;var delayTime=0;$("#autoTipDiv").size()==0&&$("body").append("<div id='autoTipDiv' class='autoTipDiv'>"+"<iframe style=\"position:absolute; z-index:-1;width:110px;\" frameborder=\"0\" src=\"about:blank\"></iframe>"+"<div id='autoTipImg'></div>"+"</div>");var $showTip=$("#autoTipDiv").hover(function(){closeFlag=false},function(){closeFlag=true;}).bind("scroll",function(){$this&&$this.focus()});var $showTipImg=$("#autoTipImg");inputs=inputs==undefined?$("input[autocomplete],textarea[autocomplete]").unbind(".autoComplete"):inputs;inputs.bind("keydown.autoComplete keyup.autoComplete blur.autoComplete",function(e){if($(this).attr("readonly"))return;if((!$this)||$this[0].id!=this.id){$this=$(this);$showTextId=$this.siblings("input[autoHidden=autoHidden]");$showTipOri=$this.siblings("div[tipDiv=tipDiv]");}
var tempCssStr=$showTipOri.attr("class");$showTip.removeClass().addClass(tempCssStr==undefined?$this.attr("divClass")==undefined?"divauto":$this.attr("divClass"):tempCssStr).css({left:$this.offset().left,top:$this.offset().top+$this.outerHeight(),height:"230px",overflowY:"auto",paddingLeft:0});$showTip.width()<$this.width()&&$showTip.width($this.width());var thisValue=this.value.trim();var $showText=$this;var targetId=$showTextId[0].id;var _key=e.which;var eType=e.type;var flag=$this.attr("flag");var sql=$this.attr("sql");sql=sql==undefined?"":sql;if(eType=="keydown"&&$showTip[0].style.display!="none"){if(_key==39||_key==40){index=index+1>maxId?1:index+1;$desObj=$("#"+targetId+"_autoTip"+index);FocusOP($oriObj,$desObj);$showTip.scrollTop((index-11)*20)}
if(_key==37||_key==38){index=index-1<1?maxId:index-1;$desObj=$("#"+targetId+"_autoTip"+index);FocusOP($oriObj,$desObj);$showTip.scrollTop((index-11)*20)}
if(_key==13||_key==9){$desObj=$oriObj;maxId!=0&&FocusOP(undefined,$oriObj,true);$showTip.hide();}
$oriObj=$desObj;}
if(eType=="keyup"){if(e.ctrlKey||e.shiftKey)return;if(this.value!=""){if(_key!=39&&_key!=40&&_key!=37&&_key!=38&&_key!=13&&_key!=17){$showTextId.val("");$showTip[0].style.display=="none"&&$showTip.show();$showTipImg.html("<span class='auo_text_loading'>正在获取数据……</span>");setTimeOutEvent!=undefined&&setTimeOutEvent!=null&&clearTimeout(setTimeOutEvent);window.autoCompleteURL=url;setTimeOutEvent=setTimeout('autoCompleteAjax(false,window.autoCompleteURL)',delayTime);}}
else{$showTip.hide();$showTextId.val("")}}
if(eType=="blur"&&closeFlag){this.value==""&&$showTextId.val("");$("#autoTipDiv").hide();}
window.autoCompleteAjax=function(isShowAll,ajaxUrl){$.ajax({type:"POST",url:ajaxUrl==undefined?basePath+"autoComplete":ajaxUrl,dataType:"json",data:"keyword="+encodeURI(thisValue)+"&sql="+encodeURI(sql)+"&flag="+flag+"&isShowAll="+isShowAll,error:function(){$showTipImg.html("<span class='auo_text_warn'>数据返回错误！</span>");},success:function(resultArray){if(resultArray!=""){maxId=resultArray.length;var divStr=[];if(maxId>10){$showTip.css({height:$showTip.height(),overflowY:"scroll"})}
for(var i=0;i<maxId;i++){var showResult=resultArray[i].name;var formatStr=showResult.replace(RegExp(thisValue,"i"),"<b><span style='color:red'>$&</span></b>");var formatStrId=resultArray[i].id;$showText.val().trim()==showResult&&$showTextId.val(formatStrId)&&$showText.val(showResult);divStr.push("<div id='"+targetId+"_autoTip"+(i+1)+"' resultOptions='resultOptions' class='itemDiv' strId='"+formatStrId+"'>"+formatStr+"</div>");}
if(!isShowAll){divStr.push("<div class='showAllDiv'><a id='isShowAll"+$showText.attr("id")+"' class='auto_text_btn'>显示全部</a></div>");}
$showTipImg.html(divStr.join(""));$showTip.show();$this.focus();$("#isShowAll"+$showText.attr("id")).bind("mousedown",function(){$showTipImg.html("<span class='auo_text_loading'>正在获取数据……</span>");autoCompleteAjax(true,url);});$showTipImg.find("div[resultOptions=resultOptions]").hover(function(){$oriObj=$(this);FocusOP($("#"+targetId+"_autoTip"+index),$oriObj);index=parseInt(this.id.replace(targetId+"_autoTip",""),10);},function(){FocusOP($(this));}).bind("mousedown",function(){FocusOP(undefined,$(this),true);$showTip.hide();});index=1;$oriObj=$("#"+targetId+"_autoTip1");FocusOP(undefined,$oriObj)}else{$showTipImg.html("<span class='auo_text_warn'>未找到匹配数据！</span>");maxId=0;}}})};function FocusOP($oriDiv,$focusObj,addFlag){$oriDiv&&$oriDiv.css("background","#FFFFFF");if($focusObj!==undefined){$focusObj.css({background:"#FBEC88"});if(addFlag){$showText.val($focusObj.text());$showTextId.val($focusObj.attr("strId"));}}}})}
$(function(){autoComplete();});